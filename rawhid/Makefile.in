EXT = @EXT@ 
DEFS = @DEFS@ 
CC = @CC@
LD = @LD@
LFLAGS = @LFLAGS@

INCLUDE = @INCLUDE@

STRIPFLAGS = @STRIPFLAGS@

PREFIX = @prefix@
INSTALL_PREFIX=$(PREFIX)

.SUFFIXES: .$(EXT)

PDCFLAGS = -g -O2 $(DEFS) $(LFLAGS)
CFLAGS = -g -O2 $(DEFS) 

LIBS = -lm -lc -lSDL
SOURCES = rawjoystick.c
TARGETS = $(SOURCES:.c=.$(EXT)) 

all: $(TARGETS) 

rawhid: $(TARGETS)
	cc -c $(CFLAGS) -DPD rawhid.c
	$(LD) $(LFLAGS) -o rawhid.$(EXT) *.o $(LIBS)
	strip @STRIPFLAGS@ rawhid.$(EXT)

clean::
	-rm *.$(EXT) *.o *~

distclean: clean
	-rm -f config.cache config.log config.status Makefile conf*.lnk
	-rm -Rf autom4te.cache autoscan.log configure.scan

.c.o:
	$(CC) -c -o $@ $(CFLAGS) -DPD $*.c

# cp $@ $*_stat.o

.o.$(EXT):
	$(CC) -o $@ $(PDCFLAGS) -DPD $*.o


install::
	install -d $(INSTALL_PREFIX)/pd/externs
	install -m 644 *.$(EXT) $(INSTALL_PREFIX)/pd/extra
	-install -m 644 rawhid.$(EXT) $(INSTALL_PREFIX)/pd/extra
	install -m 644 doc/*.pd $(INSTALL_PREFIX)/pd/doc/5.reference


dist: distclean
	(cd ..;tar czvf $(TARNAME) rawhid)
